pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                // 소스코드 체크아웃
                checkout scm
            }
        }

        stage('Build') {
            steps {
                sh '''
                    mkdir -p classes
                    find Test2/src -name "*.java" > sources.txt
                    javac -encoding UTF-8 -d classes @sources.txt
                '''
            }
        }

        stage('Test') {
            steps {
                sh '''
                    mkdir -p lib
                    curl -L -o lib/junit.jar https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone/1.7.1/junit-platform-console-standalone-1.7.1.jar
                    
                    java -jar lib/junit.jar \
                        --class-path classes \
                        --scan-class-path \
                        --details theme=ascii \
                        --reports-dir test-reports
                '''
            }
        }
    }

    post {
        always {
            junit 'test-reports/**/*.xml'
            archiveArtifacts artifacts: 'test-reports/**/*.xml', allowEmptyArchive: true
        }

        failure {
            echo 'Build or test failed'
        }

        success {
            echo 'Build and test succeeded'
        }
    }
}
